"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebInspectorEncoder = void 0;
const stream_1 = __importDefault(require("stream"));
const support_1 = require("@appium/support");
const WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE = 8096;
class WebInspectorEncoder extends stream_1.default.Transform {
    constructor() {
        super({ objectMode: true });
    }
    _transform(data, encoding, onData) {
        let payloadBuffer = support_1.plist.createPlist(data, true);
        for (let i = 0; i < payloadBuffer.length; i += this._encode(payloadBuffer, i)) { }
        onData();
    }
    _encode(data, pos) {
        const messageLength = Math.min(data.length - pos, WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE);
        if (messageLength < WEBINSPECTOR_PARTIAL_PACKET_CHUNK_SIZE) {
            this.push({ WIRFinalMessageKey: data.slice(pos, messageLength + pos) });
        }
        else {
            this.push({ WIRPartialMessageKey: data.slice(pos, messageLength + pos) });
        }
        return messageLength;
    }
}
exports.WebInspectorEncoder = WebInspectorEncoder;
exports.default = WebInspectorEncoder;
//# sourceMappingURL=webinspector-encoder.js.map